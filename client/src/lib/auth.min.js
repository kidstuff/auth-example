var kidstuff=kidstuff||{};kidstuff.auth=kidstuff.auth||{};kidstuff.auth.module=angular.module("kidstuff.auth",["LocalStorageModule"]);
kidstuff.auth.module.provider("auth",function(){var k={},g=window.location.origin;k.setEndPoint=function(f){g=f};k.$get=["$http","localStorageService",function(f,d){var k={isLoged:function(){if(null!=d.get("access_token")){var a=d.get("expired_on");if(null!=a)return moment(a,"YYYY-MM-DDTHH:mm:ssZ").isAfter(moment())?!0:(k.logout(),!1)}return!1},currentUser:function(){var a=d.get("user");if(null!=a)return a},login:function(a,b,c,e){f({method:"GET",url:g+"/tokens",params:{email:a,password:b,grant_type:"password"}}).success(function(e,
b,a,f){d.set("access_token",e.AccessToken);d.set("expired_on",e.ExpiredOn);d.set("user",e.User);c(e,b,a,f)}).error(function(b,a,c,d){e(b,a,c,d)})},logout:function(){d.remove("access_token");d.remove("expired_on");d.remove("user")},getUser:function(a,b,c){"string"==typeof a&&f({method:"GET",url:g+"/users/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,c,h){"function"==typeof b&&b(e)}).error(function(e,a,b,h){"function"==typeof c&&c(e)})},createUser:function(a,b,c){"object"==
typeof a&&f({method:"POST",url:g+"/users",data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,c,h){"function"==typeof b&&b(e)}).error(function(e,a,b,h){"function"==typeof c&&c(e)})},removeUser:function(a,b,c){"string"==typeof a&&f({method:"DELETE",url:g+"/users/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,c,h){"function"==typeof b&&b()}).error(function(e,a,b,h){"function"==typeof c&&c(e)})},updateUserProfile:function(a,b,c,e){"object"==
typeof b&&f({method:"PATCH",url:g+"/users/"+a+"/profile",data:b,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,b,d){"function"==typeof c&&c()}).error(function(a,b,c,d){"function"==typeof e&&e(a)})},updateUserApproval:function(a,b,c,e){"boolean"==typeof b&&f({method:"PUT",url:g+"/users/"+a+"/approve",data:{Approved:b},headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,b,d){"function"==typeof c&&c()}).error(function(a,b,c,d){"function"==typeof e&&
e(a)})},listUser:function(a,b,c){f({method:"GET",url:g+"/users",params:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,h){"function"==typeof b&&b(a.Users)}).error(function(a,b,d,h){"function"==typeof c&&c(a)})},removeUserGroup:function(a,b,c,e){"string"==typeof a&&"string"==typeof b&&f({method:"DELETE",url:g+"/users/"+a+"/groups/"+b,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,e,d){"function"==typeof c&&c()}).error(function(a,b,
c,d){"function"==typeof e&&e(a)})},addUserGroup:function(a,b,c,e){"string"==typeof a&&"string"==typeof b&&f({method:"PUT",url:g+"/users/"+a+"/groups",data:{Id:b},headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,e,d){"function"==typeof c&&c()}).error(function(a,b,c,d){"function"==typeof e&&e(a)})},listGroup:function(a,b,c){f({method:"GET",url:g+"/groups",params:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,f){"function"==typeof b&&
b(a.Groups)}).error(function(a,b,d,f){"function"==typeof c&&c(a)})},createGroup:function(a,b,c){f({method:"POST",url:g+"/groups",data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,f){"function"==typeof b&&b(a)}).error(function(a,b,d,f){"function"==typeof c&&c(a)})},getGroup:function(a,b,c){f({method:"GET",url:g+"/groups/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,f){"function"==typeof b&&b(a)}).error(function(a,b,d,f){"function"==
typeof c&&c(a)})},updateGroup:function(a,b,c){f({method:"PATCH",url:g+"/groups/"+a.Id,data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,f){"function"==typeof b&&b(a)}).error(function(a,b,d,f){"function"==typeof c&&c(a)})},removeGroup:function(a,b,c){f({method:"DELETE",url:g+"/groups/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,f){"function"==typeof b&&b(a)}).error(function(a,b,d,f){"function"==typeof c&&c(a)})}};return k}];
return k});