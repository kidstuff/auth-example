// 0.0.1b4
var kidstuff=kidstuff||{};kidstuff.auth=kidstuff.auth||{};kidstuff.auth.module=angular.module("kidstuff.auth",["LocalStorageModule"]);
kidstuff.auth.module.provider("auth",function(){var k={},h=window.location.origin;k.setEndPoint=function(g){h=g};k.$get=["$http","localStorageService",function(g,d){var k={isLoged:function(){if(null!=d.get("access_token")){var a=d.get("expired_on");if(null!=a)return moment(a,"YYYY-MM-DDTHH:mm:ssZ").isAfter(moment())?!0:(k.logout(),!1)}return!1},currentUser:function(){var a=d.get("user");if(null!=a)return a},login:function(a,c,b,e){if("string"!=typeof a||"string"!=typeof c)return e({error:"email/password must be string"});
g({method:"POST",url:h+"/tokens",params:{email:a,password:c,grant_type:"password"}}).success(function(e,a,c,g){d.set("access_token",e.AccessToken);d.set("expired_on",e.ExpiredOn);d.set("user",e.User);b(e,a,c,g)}).error(function(b,a,c,d){e(b,a,c,d)})},logout:function(){d.remove("access_token");d.remove("expired_on");d.remove("user")},getUser:function(a,c,b){if("string"!=typeof a)return b({error:"id must be string"});g({method:"GET",url:h+"/users/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,
b,a,f){"function"==typeof c&&c(e)}).error(function(e,a,c,f){"function"==typeof b&&b(e)})},createUser:function(a,c,b){if("object"!=typeof a)return b({error:"userInfo must be object"});g({method:"POST",url:h+"/users",data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,b,a,f){"function"==typeof c&&c(e)}).error(function(e,a,c,f){"function"==typeof b&&b(e)})},removeUser:function(a,c,b){if("string"!=typeof a)return b({error:"userId must be string"});g({method:"DELETE",url:h+
"/users/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,b,f){"function"==typeof c&&c()}).error(function(e,a,c,f){"function"==typeof b&&b(e)})},updateUserProfile:function(a,c,b,e){if("string"!=typeof a)return e({error:"id must be string"});if("object"!=typeof c)return e({error:"profile must be object"});g({method:"PATCH",url:h+"/users/"+a+"/profile",data:c,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,c,d){"function"==typeof b&&b()}).error(function(a,
b,c,d){"function"==typeof e&&e(a)})},updateUserApproval:function(a,c,b,e){if("string"!=typeof a)return e({error:"id must be string"});if("boolean"!=typeof c)return e({error:"approve must be boolean"});g({method:"PUT",url:h+"/users/"+a+"/approve",data:{Approved:c},headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(e,a,c,d){"function"==typeof b&&b()}).error(function(a,b,c,d){"function"==typeof e&&e(a)})},listUser:function(a,c,b){if("object"!=typeof a)return b({error:"params must be object"});
g({method:"GET",url:h+"/users",params:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c(a.Users)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},removeUserGroup:function(a,c,b,e){if("string"!=typeof a||"string"!=typeof c)return e({error:"userId/groupId must be string"});g({method:"DELETE",url:h+"/users/"+a+"/groups/"+c,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,e,c,d){"function"==typeof b&&b()}).error(function(a,
b,c,d){"function"==typeof e&&e(a)})},addUserGroup:function(a,c,b,e){if("string"!=typeof a||"string"!=typeof c)return e({error:"userId/groupId must be string"});g({method:"PUT",url:h+"/users/"+a+"/groups",data:{Id:c},headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,e,c,d){"function"==typeof b&&b()}).error(function(a,b,c,d){"function"==typeof e&&e(a)})},listGroup:function(a,c,b){if("object"!=typeof a)return b({error:"params must be object"});g({method:"GET",url:h+"/groups",
params:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c(a.Groups)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},createGroup:function(a,c,b){if("object"!=typeof a)return b({error:"group must be object"});g({method:"POST",url:h+"/groups",data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c(a)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},getGroup:function(a,
c,b){if("string"!=typeof a)return b({error:"id must be string"});g({method:"GET",url:h+"/groups/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c(a)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},updateGroup:function(a,c,b){if("object"!=typeof a)return b({error:"group must be object"});g({method:"PATCH",url:h+"/groups/"+a.Id,data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==
typeof c&&c(a)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},removeGroup:function(a,c,b){if("string"!=typeof a)return b({error:"id must be string"});g({method:"DELETE",url:h+"/groups/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c(a)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},updateSettings:function(a,c,b){if("object"!=typeof a)return b({error:"settings must be object"});g({method:"PATCH",url:h+"/settings",headers:{Authorization:"Bearer "+
d.get("access_token")},data:a}).success(function(a,b,d,f){"function"==typeof c&&c()}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},getSettings:function(a,c,b){if(a.constructor!=Array)return b({error:"keys must be array of string"});g({method:"GET",url:h+"/settings?keys="+a.toString(),headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c(a)}).error(function(a,c,d,f){"function"==typeof b&&b(a)})},removeSettings:function(a,c,b){if(a.constructor!=
Array)return b({error:"keys must be array of string"});g({method:"DELETE",url:h+"/settings?keys="+a.toString(),headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,b,d,f){"function"==typeof c&&c()}).error(function(a,c,d,f){"function"==typeof b&&b(a)})}};return k}];return k});