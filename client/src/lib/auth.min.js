var kidstuff=kidstuff||{};kidstuff.auth=kidstuff.auth||{};kidstuff.auth.module=angular.module("kidstuff.auth",["LocalStorageModule"]);
kidstuff.auth.module.provider("auth",function(){var h={},g=window.location.origin;h.setEndPoint=function(e){g=e};h.$get=["$http","localStorageService",function(e,d){var h={isLoged:function(){if(null!=d.get("access_token")){var a=d.get("expired_on");if(null!=a)return moment(a,"YYYY-MM-DDTHH:mm:ssZ").isAfter(moment())?!0:(h.logout(),!1)}return!1},currentUser:function(){var a=d.get("user");if(null!=a)return a},login:function(a,b,c,f){e({method:"GET",url:g+"/tokens",params:{email:a,password:b,grant_type:"password"}}).success(function(f,
b,a,e){d.set("access_token",f.AccessToken);d.set("expired_on",f.ExpiredOn);d.set("user",f.User);c(f,b,a,e)}).error(function(b,c,a,d){f(b,c,a,d)})},logout:function(){d.remove("access_token");d.remove("expired_on");d.remove("user")},getUser:function(a,b,c){"string"==typeof a&&e({method:"GET",url:g+"/users/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,c,a,k){"function"==typeof b&&b(f)}).error(function(f,b,a,k){"function"==typeof c&&c(f)})},createUser:function(a,b,c){"object"==
typeof a&&e({method:"POST",url:g+"/users",data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,a,c,k){"function"==typeof b&&b(f)}).error(function(f,b,a,k){"function"==typeof c&&c(f)})},removeUser:function(a,b,c){"string"==typeof a&&e({method:"DELETE",url:g+"/users/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,a,c,k){"function"==typeof b&&b()}).error(function(f,a,b,k){"function"==typeof c&&c(f)})},updateUserProfile:function(a,b,c,f){"object"==
typeof b&&e({method:"PATCH",url:g+"/users/"+a+"/profile",data:b,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,a,b,d){"function"==typeof c&&c()}).error(function(a,b,c,d){"function"==typeof f&&f(a)})},updateUserApproval:function(a,b,c,f){"boolean"==typeof b&&e({method:"PUT",url:g+"/users/"+a+"/approve",data:{Approved:b},headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,a,b,d){"function"==typeof c&&c()}).error(function(a,b,c,d){"function"==typeof f&&
f(a)})},listUser:function(a,b,c){e({method:"GET",url:g+"/users",params:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,a,c,d){"function"==typeof b&&b(f.Users)}).error(function(f,a,b,d){"function"==typeof c&&c(f)})},removeUserGroup:function(a,b,c,f){"string"==typeof a&&"string"==typeof b&&e({method:"DELETE",url:g+"/users/"+a+"/groups/"+b,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(f,a,b,d){"function"==typeof c&&c()}).error(function(a,b,
c,d){"function"==typeof f&&f(a)})},addUserGroup:function(a,b,c,f){"string"==typeof a&&"string"==typeof b&&e({method:"PUT",url:g+"/users/"+a+"/groups",data:{Id:b},headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,f,b,d){"function"==typeof c&&c()}).error(function(a,b,c,d){"function"==typeof f&&f(a)})},listGroup:function(a,b,c){e({method:"GET",url:g+"/groups",params:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&
b(a.Groups)}).error(function(a,b,d,e){"function"==typeof c&&c(a)})},createGroup:function(a,b,c){e({method:"POST",url:g+"/groups",data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&b(a)}).error(function(a,b,d,e){"function"==typeof c&&c(a)})},getGroup:function(a,b,c){e({method:"GET",url:g+"/groups/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&b(a)}).error(function(a,b,d,e){"function"==
typeof c&&c(a)})},updateGroup:function(a,b,c){e({method:"PATCH",url:g+"/groups/"+a.Id,data:a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&b(a)}).error(function(a,b,d,e){"function"==typeof c&&c(a)})},removeGroup:function(a,b,c){e({method:"DELETE",url:g+"/groups/"+a,headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&b(a)}).error(function(a,b,d,e){"function"==typeof c&&c(a)})},updateSettings:function(a,
b,c){"object"==typeof a&&e({method:"PATCH",url:g+"/settings",headers:{Authorization:"Bearer "+d.get("access_token")},data:a}).success(function(a,c,d,e){"function"==typeof b&&b()}).error(function(a,b,d,e){"function"==typeof c&&c(a)})},getSettings:function(a,b,c){e({method:"GET",url:g+"/settings?keys="+a.toString(),headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&b(a)}).error(function(a,b,d,e){"function"==typeof c&&c(a)})},removeSettings:function(a,
b,c){e({method:"DELETE",url:g+"/settings?keys="+a.toString(),headers:{Authorization:"Bearer "+d.get("access_token")}}).success(function(a,c,d,e){"function"==typeof b&&b()}).error(function(a,b,d,e){"function"==typeof c&&c(a)})}};return h}];return h});